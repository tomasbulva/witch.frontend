!function(){"use strict";var modules=["ngAnimate","ui.router","hue","ngStorage","btford.socket-io","timer","angular-draggable"];angular.module("witch",modules)}(),angular.module("witch").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("app/offScreen/offScreenMainView.html",'<lightStateBackground>\n<screenButton\n  ng-click="vm.switchLightOn()"\n>\n\n  <svg class="icons logo">\n    <use xlink:href="#logo"/>\n  </svg>\n\n</screenButton>\n</lightStateBackground>\n'),$templateCache.put("app/onScreen/onScreenMainView.html",'<lightStateBackground\n  light-color\n>\n\n  <brightnessToggle\n    ng-draggable\n    top="vm.topPos"\n    data-bla="{{vm.topPos}}"\n    lockx="true"\n    slider-control-x="vm.brightness"\n    lock-to-screen-size="true"\n    on-double-click="vm.switchLightOff()"\n  >\n    <handle></handle>\n  </brightnessToggle>\n\n  <drawer>\n   A\n  </drawer>\n\n</lightStateBackground>\n'),$templateCache.put("app/settingsScreen/SettingsScreenStep1.html",'<section id="wifi-setup-step-1">\n  <ul>\n    <li ng-repeat="ap in vm.aps" ng-click="vm.selectWifi(ap)">{{ ap.apName }}</li>\n  </ul>\n</section>\n'),$templateCache.put("app/settingsScreen/settingsScreenMainView.html",'<header>\n</header>\n\n<main ui-view="setupScreen">\n</main>\n\n<footer>\n</footer>\n'),$templateCache.put("app/settingsScreen/settingsScreenStep2.html",'<section id="wifi-setup-step-2" class="">\n\n  <form name="wifiPasswordForm">\n\n    <input name=" password "\n      ng-class=""\n      type="{{ vm.seePass }}"\n      ng-model=" vm.wifi.password "\n      ng-blur=" vm.submitPass() "\n      ng-enter-key=" vm.submitPass() "\n      required=" true "\n      autocomplete=" off "\n    >\n    <input\n      type="checkbox"\n      id="checkbox"\n      ng-click="vm.hideShowPassword()"\n    >\n\n    <button name=" signInAp "\n      ng-click=" vm.submitPass() "\n    >\n    submit\n    </button>\n\n  </form>\n</section>\n'),$templateCache.put("app/settingsScreen/settingsScreenStep3.html",'<section id="group-setup">\n  <p>please push the hub button to connect with the witch.</p>\n  <timer countdown="30" interval="1000"><div class="progress active {{displayProgressActive}}"style="height: 3px;"><div class="bar" style="min-width: 2em;width: {{progressBar}}%;"></div> </div></timer>\n</section>\n'),$templateCache.put("app/settingsScreen/settingsScreenStep4.html",'<section id="lights-setup-step-4">\n  <section id="switch-style">\n    <label for="useGroups">\n      <input id="useGroups" type=\'radio\' name="useGroups" ng-model="vm.useGroups" value="true">\n      Use groups.\n    </label>\n    <label for="useLight">\n      <input id="useLights" type=\'radio\' name="useGroups" ng-model="vm.useGroups" value="false">\n      Use individual lights.\n    </label>\n  </section>\n\n  <section id="group-setup"\n    ng-class="{\n      \'active\': vm.useGroups === \'true\'\n    }"\n  >\n    <ul>\n      <li ng-repeat="(id, group) in vm.groups" ng-click="vm.pickGroup(id, group)">{{ group.name }}</li>\n    </ul>\n  </section>\n\n  <section id="light-setup"\n    ng-class="{\n      \'active\': vm.useGroups === \'false\'\n    }"\n  >\n    <ul>\n      <li ng-repeat="(id, light) in vm.lights" ng-click="vm.pickLight(id, light)">{{ light.name }}</li>\n    </ul>\n  </section>\n</section>\n'),$templateCache.put("app/svg.html",'<svg version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><symbol viewBox="0 0 98 98" id="logo"><title>Triangle</title><desc>Created with Sketch.</desc> <!-- Generator: Sketch 40.3 (33839) - http://www.bohemiancoding.com/sketch -->    <g id="logo-Page-v2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="logo-screen---switch-off" transform="translate(-71.000000, -101.000000)" stroke-width="6" stroke="#292929"> <polygon id="logo-Triangle" points="120 108 164 196 76 196"/> </g> </g> </symbol></svg>')}]),function(){"use strict";angular.module("witch").constant("ENV","dev").constant("DEVICE","witch#1234567890").constant("TEST_URL","http://www.google.com/")}(),function(){"use strict";function routing($stateProvider,$urlRouterProvider,$locationProvider,$urlMatcherFactoryProvider){console.log("routing"),$stateProvider.whenLightsReady("off",{url:"/off",views:{superview:{templateProvider:function($templateCache){return $templateCache.get("app/offScreen/offScreenMainView.html")},controller:"offScreen as vm"}}}).whenLightsReady("on",{url:"/on",views:{superview:{templateProvider:function($templateCache){return $templateCache.get("app/onScreen/onScreenMainView.html")},controller:"onScreen as vm"}}}).state("settings",{url:"/settings",redirectTo:"settings.selectAP",views:{superview:{templateProvider:function($templateCache){return $templateCache.get("app/settingsScreen/settingsScreenMainView.html")},controller:"settingsScreen as vm"}}}).state("settings.selectAP",{url:"/selectap",views:{setupScreen:{templateProvider:function($templateCache){return $templateCache.get("app/settingsScreen/SettingsScreenStep1.html")},controller:"settingsScreen as vm"}}}).state("settings.setWifiPassword",{url:"/setWifiPassword",views:{setupScreen:{templateProvider:function($templateCache){return $templateCache.get("app/settingsScreen/settingsScreenStep2.html")},controller:"settingsScreen as vm"}}}).state("settings.connectToHueHub",{url:"/connectToHueHub",views:{setupScreen:{templateProvider:function($templateCache){return $templateCache.get("app/settingsScreen/settingsScreenStep3.html")},controller:"settingsScreen as vm"}}}).state("settings.selectLightGroup",{url:"/selectLightGroup",views:{setupScreen:{templateProvider:function($templateCache){return $templateCache.get("app/settingsScreen/settingsScreenStep4.html")},controller:"settingsScreen as vm"}}}),$urlRouterProvider.otherwise("/off"),window.history&&window.history.pushState&&$locationProvider.html5Mode({enabled:!0,requireBase:!1}).hashPrefix("!")}function preRouting($qProvider,$stateProvider,$urlRouterProvider,$locationProvider){function whenLightsReady(state,route){return route.resolve=route.resolve||{},route.resolve.light=lightsReady,console.log("whenLightsReady",state,route),$stateProvider.state(state,route),$stateProvider}$stateProvider.whenLightsReady=whenLightsReady}function lightsReady($rootScope,$state,local,ENV,$q,$timeout,hue){var deferred=$q.defer(),localData=local.getAllData();return console.log("localData",localData),console.log("$rootScope",$rootScope),console.log("$state",$state),localData&&localData.username&&localData.target?(hue.setup({username:localData.username,bridgeIP:"",debug:"dev"===ENV}),hue.getGroups().then(function(_groups){var groups=_groups;console.log("groups",groups),deferred.resolve(groups)}),deferred.promise):($timeout(function(){$state.go("settings")}),deferred.reject("redirecting"))}angular.module("witch").config(preRouting).config(routing),routing.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$urlMatcherFactoryProvider"],preRouting.$inject=["$qProvider","$stateProvider","$urlRouterProvider","$locationProvider"],lightsReady.$inject=["$rootScope","$state","local","ENV","$q","$timeout","hue"]}(),function(){"use strict";function localStorageHandler($localStorage,DEVICE){function _getAllData(){return $localStorage[DEVICE]}function _init(){$localStorage[DEVICE]||($localStorage[DEVICE]={state:null,window:{width:null,height:null}})}console.log("localStorageHandler");var service={getAllData:_getAllData,init:_init};return service}function globalApp(){console.log("globalApp");var service={state:null,window:{width:null,height:null}};return service}function socket($rootScope,socketFactory){return socketFactory({ioSocket:io.connect("http://0.0.0.0:9999")})}function runSettings($window,$rootScope,$state,$uiRouter,$trace){$rootScope.online=navigator.onLine,$window.addEventListener("offline",function(){$rootScope.$apply(function(){$rootScope.online=!1})},!1),$window.addEventListener("online",function(){$rootScope.$apply(function(){$rootScope.online=!0})},!1)}function bodyDecorator($rootScope,$state,local,$transitions,$window){function linkFunc(scope,el,attrs){local.getAllData()||local.init();var localData=local.getAllData();localData.window||(localData.window={}),$transitions.onStart({},function($transition$){el.addClass("loading")}),$transitions.onSuccess({},function($transition$){el.removeClass("loading");var newState=$transition$.$to();el.attr("bd",newState||"unknown"),localData.state=newState.name});var w=angular.element($window),sizeGuard=function(){var _width=w.width(),_height=w.height();localData.window.width=_width,localData.window.height=_height;var css="width: "+_width+"px ; height: "+_height+"px";attrs.$set("style",css)};w.bind("resize",sizeGuard),sizeGuard()}var directive={link:linkFunc,restrict:"A"};return directive}angular.module("witch").run(runSettings).factory("globalApp",globalApp).factory("local",localStorageHandler).factory("socket",socket).directive("bd",bodyDecorator),localStorageHandler.$inject=["$localStorage","DEVICE"],globalApp.$inject=[],socket.$inject=["$rootScope","socketFactory"],runSettings.$inject=["$window","$rootScope","$state","$uiRouter","$trace"],bodyDecorator.$inject=["$rootScope","$state","local","$transitions","$window"]}(),function(){"use strict";function colorHelper(){function HelperRGBtoHueAngSatBri(Red,Green,Blue){var Ang,Sat,Bri,Min=Math.min(Red,Green,Blue),Max=Math.max(Red,Green,Blue);return Min!==Max?(Ang=Red===Max?60*(0+(Green-Blue)/(Max-Min)):Green===Max?60*(2+(Blue-Red)/(Max-Min)):60*(4+(Red-Green)/(Max-Min)),Sat=(Max-Min)/Max,Bri=Max):(Ang=0,Sat=0,Bri=Max),{Ang:Ang,Sat:Sat,Bri:Bri}}function HelperHuetoHueAng(Hue){var Ang=360*Hue/65535;return Ang>0&&(Ang<90?Ang-=.17*Ang*(Ang/90):Ang<180&&(Ang-=.17*(180-Ang)*((180-Ang)/90))),Ang}function HelperHueAngSatBritoRGB(Ang,Sat,Bri){var Red,Green,Blue;if(0===Sat)Red=Bri,Green=Bri,Blue=Bri;else{var Sector=Math.floor(Ang/60)%6,Fraction=Ang/60-Sector,p=Bri*(1-Sat),q=Bri*(1-Sat*Fraction),t=Bri*(1-Sat*(1-Fraction));switch(Sector){case 0:Red=Bri,Green=t,Blue=p;break;case 1:Red=q,Green=Bri,Blue=p;break;case 2:Red=p,Green=Bri,Blue=t;break;case 3:Red=p,Green=q,Blue=Bri;break;case 4:Red=t,Green=p,Blue=Bri;break;default:Red=Bri,Green=p,Blue=q}}return{Red:Red,Green:Green,Blue:Blue}}function HelperRGBtoXY(Red,Green,Blue){Red>.04045?Red=Math.pow((Red+.055)/1.055,2.4):Red/=12.92,Green>.04045?Green=Math.pow((Green+.055)/1.055,2.4):Green/=12.92,Blue>.04045?Blue=Math.pow((Blue+.055)/1.055,2.4):Blue/=12.92;var X=.664511*Red+.154324*Green+.162028*Blue,Y=.283881*Red+.668433*Green+.047685*Blue,Z=88e-6*Red+.07231*Green+.986039*Blue;return X+Y+Z===0?{x:0,y:0}:{x:X/(X+Y+Z),y:Y/(X+Y+Z)}}function HelperGamutXYforModel(Px,Py,Model){Model=Model||"LCT001";var PRed,PGreen,PBlue,NormDot,ModelType=Model.slice(0,3);"LCT"===ModelType?(PRed={x:.674,y:.322},PGreen={x:.408,y:.517},PBlue={x:.168,y:.041}):"LLC"===ModelType||"LST"===ModelType?(PRed={x:.703,y:.296},PGreen={x:.214,y:.709},PBlue={x:.139,y:.081}):(PRed={x:1,y:0},PGreen={x:0,y:1},PBlue={x:0,y:0});var VBR={x:PRed.x-PBlue.x,y:PRed.y-PBlue.y},VRG={x:PGreen.x-PRed.x,y:PGreen.y-PRed.y},VGB={x:PBlue.x-PGreen.x,y:PBlue.y-PGreen.y},GBR=(PGreen.x-PBlue.x)*VBR.y-(PGreen.y-PBlue.y)*VBR.x,BRG=(PBlue.x-PRed.x)*VRG.y-(PBlue.y-PRed.y)*VRG.x,RGB=(PRed.x-PGreen.x)*VGB.y-(PRed.y-PGreen.y)*VGB.x,VBP={x:Px-PBlue.x,y:Py-PBlue.y},VRP={x:Px-PRed.x,y:Py-PRed.y},VGP={x:Px-PGreen.x,y:Py-PGreen.y},PBR=VBP.x*VBR.y-VBP.y*VBR.x,PRG=VRP.x*VRG.y-VRP.y*VRG.x,PGB=VGP.x*VGB.y-VGP.y*VGB.x;return GBR*PBR>=0&&BRG*PRG>=0&&RGB*PGB>=0?{x:Px,y:Py}:GBR*PBR<=0?(NormDot=(VBP.x*VBR.x+VBP.y*VBR.y)/(VBR.x*VBR.x+VBR.y*VBR.y),NormDot>=0&&NormDot<=1?{x:PBlue.x+NormDot*VBR.x,y:PBlue.y+NormDot*VBR.y}:NormDot<0?{x:PBlue.x,y:PBlue.y}:{x:PRed.x,y:PRed.y}):BRG*PRG<=0?(NormDot=(VRP.x*VRG.x+VRP.y*VRG.y)/(VRG.x*VRG.x+VRG.y*VRG.y),NormDot>=0&&NormDot<=1?{x:PRed.x+NormDot*VRG.x,y:PRed.y+NormDot*VRG.y}:NormDot<0?{x:PRed.x,y:PRed.y}:{x:PGreen.x,y:PGreen.y}):RGB*PGB<=0?(NormDot=(VGP.x*VGB.x+VGP.y*VGB.y)/(VGB.x*VGB.x+VGB.y*VGB.y),NormDot>=0&&NormDot<=1?{x:PGreen.x+NormDot*VGB.x,y:PGreen.y+NormDot*VGB.y}:NormDot<0?{x:PGreen.x,y:PGreen.y}:{x:PBlue.x,y:PBlue.y}):void 0}function HelperXYtoRGB(x,y,Brightness){Brightness=Brightness||1;var z=1-x-y,Y=Brightness,X=Y/y*x,Z=Y/y*z,Red=1.656492*X-.354851*Y-.255038*Z,Green=.707196*-X+1.655397*Y+.036152*Z,Blue=.051713*X-.121364*Y+1.01153*Z;return Red>Blue&&Red>Green&&Red>1&&(Green/=Red,Blue/=Red,Red=1),Red<0&&(Red=0),Green>Blue&&Green>Red&&Green>1&&(Red/=Green,Blue/=Green,Green=1),Green<0&&(Green=0),Blue>Red&&Blue>Green&&Blue>1&&(Red/=Blue,Green/=Blue,Blue=1),Blue<0&&(Blue=0),Red<=.0031308?Red*=12.92:Red=1.055*Math.pow(Red,1/2.4)-.055,Green<=.0031308?Green*=12.92:Green=1.055*Math.pow(Green,1/2.4)-.055,Blue<=.0031308?Blue*=12.92:Blue=1.055*Math.pow(Blue,1/2.4)-.055,Red>Blue&&Red>Green&&Red>1&&(Green/=Red,Blue/=Red,Red=1),Red<0&&(Red=0),Green>Blue&&Green>Red&&Green>1&&(Red/=Green,Blue/=Green,Green=1),Green<0&&(Green=0),Blue>Red&&Blue>Green&&Blue>1&&(Red/=Blue,Green/=Blue,Blue=1),Blue<0&&(Blue=0),{Red:Red,Green:Green,Blue:Blue}}function HelperXYtoRGBforModel(x,y,Brightness,Model){var GamutCorrected=huepi.HelperGamutXYforModel(x,y,Model);return huepi.HelperXYtoRGB(GamutCorrected.x,GamutCorrected.y,Brightness)}function HelperColortemperaturetoRGB(Temperature){var Red,Green,Blue;return Temperature/=100,Temperature<=66?Red=165+90*(Temperature/66):(Red=Temperature-60,Red=329.698727466*Math.pow(Red,-.1332047592),Red<0&&(Red=0),Red>255&&(Red=255)),Temperature<=66?(Green=Temperature,Green=99.4708025861*Math.log(Green)-161.1195681661,Green<0&&(Green=0),Green>255&&(Green=255)):(Green=Temperature-60,Green=288.1221695283*Math.pow(Green,-.0755148492),Green<0&&(Green=0),Green>255&&(Green=255)),Temperature>=66?Blue=255:Temperature<=19?Blue=0:(Blue=Temperature-10,Blue=138.5177312231*Math.log(Blue)-305.0447927307,Blue<0&&(Blue=0),Blue>255&&(Blue=255)),{Red:Red/255,Green:Green/255,Blue:Blue/255}}function HelperToStringArray(Items){if("number"==typeof Items)return'"'+Items.toString()+'"';if("[object Array]"===Object.prototype.toString.call(Items)){for(var Result="[",ItemNr=0;ItemNr<Items.length;ItemNr++)Result+=huepi.HelperToStringArray(Items[ItemNr]),ItemNr<Items.length-1&&(Result+=",");return Result+="]"}return"string"==typeof Items?'"'+Items+'"':void 0}function HelperTwoFiftyFifeRange(value){if("object"==typeof value){var result={};switch(!0){case void 0!==value.red&&void 0!==value.green&&void 0!==value.blue:result.red=Math.round(255*value.red),result.green=Math.round(255*value.green),result.blue=Math.round(255*value.blue);break;case void 0!==value.Red&&void 0!==value.Green&&void 0!==value.Blue:result.Red=Math.round(255*value.Red),result.Green=Math.round(255*value.Green),result.Blue=Math.round(255*value.Blue);break;case void 0!==value.r&&void 0!==value.g&&void 0!==value.b:result.r=Math.round(255*value.r),result.g=Math.round(255*value.g),result.b=Math.round(255*value.b)}return result}if("string"==typeof value){for(var resultArr=[],valueArr=value.split(","),i=valueArr.length;i--;)resultArr[i]=Math.round(255*parseInt(valueArr[i]));return resultArr.join(",")}return value}function HelperRgbToHex(value){if("object"==typeof value){var result={};switch(!0){case void 0!==value.red&&void 0!==value.green&&void 0!==value.blue:result.red=parseInt(value.red,10).toString(16),result.green=parseInt(value.green,10).toString(16),result.blue=parseInt(value.blue,10).toString(16);break;case void 0!==value.Red&&void 0!==value.Green&&void 0!==value.Blue:result.Red=parseInt(value.Red,10).toString(16),result.Green=parseInt(value.Green,10).toString(16),result.Blue=parseInt(value.Blue,10).toString(16);break;case void 0!==value.r&&void 0!==value.g&&void 0!==value.b:result.r=parseInt(value.r,10).toString(16),result.g=parseInt(value.g,10).toString(16),result.b=parseInt(value.b,10).toString(16)}var resultStr="#";for(var c in result)resultStr+=result[c];return resultStr}if("string"==typeof value){for(var resultArr=[],valueArr=value.split(","),i=valueArr.length;i--;)resultArr[i]=parseInt(valueArr[i],10).toString(16);return"#"+resultArr.join("")}}function HelperNormalizeBri(bri,reverse){var flipBri=reverse?100-bri:bri,maxBri=254,maxBriPrc=maxBri/100,result=Math.round(flipBri*maxBriPrc);return result}function HelperHexToZeroToOne(bri){var maxBri=254,maxBriPrc=maxBri/100,result=(bri/maxBriPrc/100).toFixed(4);return result}function HelperBriToScreenPos(bri,screenHeight){var briPerc=this.HexToZeroToOne(bri),result=screenHeight*briPerc;return console.log(" "),console.log("HelperBriToScreenPos bri",bri,"screenHeight",screenHeight),console.log(" "),console.log(result),console.log(" "),result}var service={RGBtoHueAngSatBri:HelperRGBtoHueAngSatBri,HuetoHueAng:HelperHuetoHueAng,HueAngSatBritoRGB:HelperHueAngSatBritoRGB,RGBtoXY:HelperRGBtoXY,GamutXYforModel:HelperGamutXYforModel,XYtoRGB:HelperXYtoRGB,XYtoRGBforModel:HelperXYtoRGBforModel,ColortemperaturetoRGB:HelperColortemperaturetoRGB,ToStringArray:HelperToStringArray,TwoFiftyFifeRange:HelperTwoFiftyFifeRange,RgbToHex:HelperRgbToHex,NormalizeBri:HelperNormalizeBri,HexToZeroToOne:HelperHexToZeroToOne,BriToScreenPos:HelperBriToScreenPos};return service}angular.module("witch").factory("colors",colorHelper)}(),function(){"use strict";function settingsScreen($state,$scope,$rootScope,local,DEVICE,TEST_URL,ENV,hue,$http,socket,$interval){function selctAP(){$rootScope.online?vm.aps||(console.log("get aps"),socket.emit("aps",{}),socket.on("aps",function(data){vm.aps=data,console.log("get aps",vm.aps)})):$state.go("settings.connectToHueHub"),vm.selectWifi=function(ap){$state.go("settings.setWifiPassword")}}function setWifiPassword(){vm.submitPass=function(){$state.go("settings.setWifiPassword")},vm.hideShowPassword=function(){"password"===vm.seePass?(console.log("text"),vm.seePass="text"):(console.log("password"),vm.seePass="password")},vm.submitPass=function(){$state.go("settings.connectToHueHub")}}function connectToHueHub(){var localData=local.getAllData(),int=null;hue.setup({username:"newUser",bridgeIP:"",debug:"dev"===ENV}),int=$interval(function(){hue.createUser(DEVICE).then(function(result){console.log(result[0].success),result[0].success&&($interval.cancel(int),local.init(),localData.username=result[0].success.username,$state.go("settings.selectLightGroup"))}).catch(function(error){console.error("catch",error)})},500,60)}function selectLightGroup(){function getData(){"true"===vm.useGroups?(console.log("getting groups"),hue.getGroups().then(function(_groups){vm.groups=_groups,"dev"===ENV&&console.log("groups",vm.groups)})):(console.log("getting lights"),hue.getLights().then(function(_lights){vm.lights=_lights,"dev"===ENV&&console.log("lights",vm.lights)}))}vm.getData=getData,vm.groups=null,vm.lights=null,vm.useGroups="true";var localData=local.getAllData();hue.setup({username:localData.username,bridgeIP:"",debug:"dev"===ENV}),getData(),$scope.$watch("vm.useGroups",function(newData,oldData){newData!==oldData&&(console.log("$watch lights",newData),getData())}),vm.pickGroup=function(id,group){var isOn=group.state.all_on;localData.target=group,localData.target.id=id,localData.target.style="group",isOn?$state.go("on"):$state.go("off")},vm.pickLight=function(id,group){var isOn=group.state.on;localData.target=group,localData.target.id=id,localData.target.style="light",isOn?$state.go("on"):$state.go("off")}}var vm=this;switch($state.current.name){case"settings.selectAP":selctAP();break;case"settings.setWifiPassword":setWifiPassword();break;case"settings.connectToHueHub":connectToHueHub();break;case"settings.selectLightGroup":selectLightGroup()}console.log("settingsScreen")}angular.module("witch").controller("settingsScreen",settingsScreen),settingsScreen.$inject=["$state","$scope","$rootScope","local","DEVICE","TEST_URL","ENV","hue","$http","socket","$interval"]}(),function(){"use strict";function onScreen($scope,$state,local,hue,colors){function activate(){vm.brightness!==vm.localData.target.action.bri&&(vm.localData.target.action.bri=vm.brightness),console.log("vm.brightness",vm.brightness),vm.topPos=colors.BriToScreenPos(vm.brightness,vm.localData.window.height),console.log("vm.topPos",vm.topPos),"light"!==vm.localData.target.style?hue.setGroupState(vm.localData.target.id,{on:!0}):hue.setLightState(vm.localData.target.id,{on:!0}),$scope.$watch("vm.brightness",_.throttle(briChangeWatch,500))}function briChangeWatch(newBri,oldBri){if(newBri!==oldBri){console.log("newBri",newBri);var bri=colors.NormalizeBri(newBri,!0);vm.localData.target.action.bri=bri,console.log("briChangeWatch",local.getAllData().target.action.bri),0===bri&&$state.go("off"),"light"!==vm.localData.target.style?hue.setGroupState(vm.localData.target.id,{bri:bri}):hue.setLightState(vm.localData.target.id,{bri:bri})}}function switchLightOff(){console.log("switch off"),$state.go("off")}var vm=this;vm.localData=local.getAllData(),vm.brightness=vm.localData.target.action.bri<=0||vm.localData.target.action.bri>254?45:vm.localData.target.action.bri,vm.topPos=0,vm.switchLightOff=switchLightOff,activate(),briChangeWatch(vm.brightness,null)}function colorSetter(local,colors){function linkFunc(scope,el,attrs){function changeColors(){var x=localData.target.action.xy[0],y=localData.target.action.xy[1],bri=localData.target.action.bri,col=colors.XYtoRGB(x,y,colors.HexToZeroToOne(bri));console.log("changeColors x,y,bri",x,y,colors.HexToZeroToOne(bri));var RGBColors=colors.TwoFiftyFifeRange(col),HEXColors=colors.RgbToHex(RGBColors);console.log("changeColors HEXColors",col);var css="background-color: "+HEXColors;attrs.$set("style",css)}var localData=local.getAllData();scope.$watch(function(){return localData.target.action.xy[0]},changeColors),scope.$watch(function(){return localData.target.action.xy[1]},changeColors),scope.$watch(function(){return localData.target.action.bri},changeColors)}var directive={link:linkFunc,restrict:"A"};return directive}angular.module("witch").directive("lightColor",colorSetter).controller("onScreen",onScreen),onScreen.$inject=["$scope","$state","local","hue","colors"],colorSetter.$inject=["local","colors"]}(),function(){"use strict";function offScreen($scope,$state,local,hue){var vm=this,localData=local.getAllData();localData.target&&localData.target.id&&"group"===localData.target.type?hue.setGroupState(localData.target.id,{on:!1}):localData.target&&localData.target.id?hue.setLightState(localData.target.id,{on:!1}):$state.go("settings"),vm.switchLightOn=function(){$state.go("on")}}angular.module("witch").controller("offScreen",offScreen),offScreen.$inject=["$scope","$state","local","hue"]}();